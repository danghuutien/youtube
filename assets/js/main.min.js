!function(){"use strict";function e(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout((()=>{e(...o)}),t)}}class t{constructor(){this.callbacks=[],window.addEventListener("DOMContentLoaded",(()=>this.onDOMContentLoaded()))}onDOMContentLoaded(){this.callbacks.sort(((e,t)=>e.priority-t.priority)).forEach((({callback:e})=>e()))}runOnLoad(e){"loading"===document.readyState?this.callbacks.push(e):e.callback()}}class n{constructor(e){this.items=[],this.previousWidth=document.documentElement.clientWidth,this.previousHeight=window.innerHeight;const t=e((()=>this.onWindowResize()),100);window.addEventListener("resize",t)}onWindowResize(){const e=document.documentElement.clientWidth,t=window.innerHeight,n=this.previousWidth!==e,o=this.previousHeight!==t;this.items.forEach((e=>{const t=()=>{e.callback(),e.executed=!0};(!e.executed||n&&e.options.runOnWidthChange||o&&e.options.runOnHeightChange)&&t()})),this.previousWidth=e,this.previousHeight=t}runOnResize(e,n){this.items.push({callback:e,options:n,executed:n.runOnLoad}),this.items.sort(((e,t)=>e.options.priority-t.options.priority)),n.runOnLoad&&function(e,n=Number.MAX_VALUE){var o;(window.canva_scriptExecutor=null!==(o=window.canva_scriptExecutor)&&void 0!==o?o:new t).runOnLoad({callback:e,priority:n})}(e,n.priority)}}function o(t,o,i=e){var a;(window.canva_debounceResize=null!==(a=window.canva_debounceResize)&&void 0!==a?a:new n(i)).runOnResize(t,{runOnLoad:!1,runOnWidthChange:!0,runOnHeightChange:!1,priority:Number.MAX_VALUE,...o})}var i;const a="undefined"!=typeof window?null===(i=window.navigator)||void 0===i?void 0:i.userAgent:void 0;const r=!(!a||(s=a,!s.match(/AppleWebKit\//)||s.match(/Chrome\//)||s.match(/Chromium\//)));var s;!function(){const e=document.querySelectorAll("video");if(!e.length)return;(function(){if(document.querySelector("template#playPauseButton"))return;const e='\n<div class="playPauseButton">\n<svg class="loadingIndicator" style="display: none" viewBox="0 0 50 50"><path d="M 25 1 A 24 24 0 1 1 24.9 1" stroke="white" stroke-opacity="0.5" stroke-width="2" fill="none"></svg>\n<svg class="playSvg" width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.248 4.212l11.05 6.574c.694.412.91 1.29.483 1.961-.121.19-.287.35-.483.467l-11.05 6.574c-.694.413-1.602.204-2.03-.467A1.39 1.39 0 0 1 6 18.574V5.426C6 4.638 6.66 4 7.475 4c.273 0 .54.073.773.212z" fill="currentColor"/></svg>\n<svg class="pauseSvg" style="display: none" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><rect x="7" y="5" width="3" height="14" rx="1.5" fill="currentColor"/><rect x="14" y="5" width="3" height="14" rx="1.5" fill="currentColor"/></svg>\n</div>\n'.trim(),t="\n  .playPauseButton {\n    cursor: pointer;\n    position: absolute;\n    top: calc(50% - 24px);\n    left: calc(50% - 24px);\n    width: 48px;\n    height: 48px;\n    border-radius: 100%;\n    background: rgba(17,23,29,.4);\n    transition: opacity 0.2s ease-out;\n    color: white;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  .loadingIndicator {\n    width: 48px;\n    height: 48px;\n    position: absolute;\n  }\n  .loadingIndicator path {\n    stroke-dasharray: 175;\n    stroke-dashoffset: 350;\n    animation: dash 5s linear forwards;\n    animation-iteration-count: infinite;\n  }\n  @keyframes dash {\n    to {\n      stroke-dashoffset: 0;\n    }\n  }\n".trim(),n=document.createElement("template");n.id="playPauseButton",n.innerHTML=e,document.body.appendChild(n);const o=document.createElement("style");o.innerHTML=t,document.body.appendChild(o)})(),function(){if(document.querySelector("template#seekBar"))return;const e='\n<div class="videoSeek">\n  <div class="videoSeekBarContainer">\n    <div class="videoSeekBar">\n      <div class="videoSeekBarCurrent"></div>\n    </div>\n    <input class="videoSeekInput" type="range" min="0" max="100" step="any" value="0" disabled="disabled">\n  </div>\n  <div class="soundButton">\n    <svg class="soundOnSvg" width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.5 5.102L8.778 8.35a2.5 2.5 0 0 1-1.643.616H4.5v6.065h2.632a2.5 2.5 0 0 1 1.644.617l3.724 3.25V5.102zM14 19.998c0 .858-1.01 1.318-1.658.753L7.79 16.778a1 1 0 0 0-.658-.247H4a1 1 0 0 1-1-1V8.466a1 1 0 0 1 1-1h3.135a1 1 0 0 0 .657-.246l4.55-3.971C12.99 2.684 14 3.143 14 4.002v15.996zM15.25 7a.75.75 0 0 1 .75-.75 5.75 5.75 0 0 1 0 11.5.75.75 0 0 1 0-1.5 4.25 4.25 0 0 0 0-8.5.75.75 0 0 1-.75-.75zM16 9.25a.75.75 0 0 0 0 1.5 1.25 1.25 0 1 1 0 2.5.75.75 0 0 0 0 1.5 2.75 2.75 0 1 0 0-5.5z" fill="currentColor"/></svg>\n    <svg class="soundMutedSvg" width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.5 5.08l-3.742 3.171a2.5 2.5 0 01-.243.182L15.5 12.4V5.08zm1.5 8.814V4.002a1 1 0 00-1.646-.763l-4.566 3.868a1 1 0 01-.398.206L6.53 3.468a.75.75 0 10-1.06 1.063l14 13.94a.75.75 0 101.06-1.063L17 13.894zM6.293 7.637l1.208 1.207H7.5v5.8h2.642a2.5 2.5 0 011.616.593l3.742 3.17v-1.564l1.5 1.5v1.143a1 1 0 01-1.646.763l-4.566-3.868a1 1 0 00-.646-.237H7a1 1 0 01-1-1v-6.8c0-.276.112-.526.293-.707z" fill="currentColor"/></svg>\n  </div>\n</div>\n'.trim(),t="\n  .videoSeek {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    padding: 0;\n    box-sizing: border-box;\n    background: linear-gradient(0, rgba(17,23,29,.4) 0%, transparent 100%);\n    color: white;\n    transition: opacity 0.2s ease-out;\n    opacity: 0;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n  }\n\n  .soundButton {\n    flex-grow: 0;\n    flex-shrink: 0;\n    margin-right: 24px;\n    cursor: pointer;\n  }\n\n  .soundOnSvg,\n  .soundMutedSvg {\n    color: white;\n  }\n\n  .soundMutedSvg {\n    display: none;\n  }\n\n  .videoSeekBarContainer {\n    position: relative;\n    flex-grow: 1;\n  }\n\n  .videoSeekBar {\n    position: absolute;\n    top: calc(50% - 2px);\n    left: 22px;\n    right: 22px;\n    height: 4px;\n    background: rgba(255, 255, 255, 0.4);\n    border-radius: 4px;\n  }\n\n  .videoSeekBarCurrent {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    background: white;\n    border-radius: 4px;\n  }\n\n  .videoSeekInput {\n    position: relative;\n    display: block;\n    box-sizing: border-box;\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    padding: 16px 8px;\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n    background: none;\n    direction: ltr;\n  }\n\n  .videoSeekInput:hover {\n    cursor: pointer;\n  }\n\n  .videoSeekInput:active {\n    cursor: grabbing;\n  }\n\n  /* chrome, safari */\n  .videoSeekInput::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    box-sizing: border-box;\n    width: 40px;\n    height: 40px;\n    border: 14px solid transparent;\n    border-radius: 100%;\n    background-clip: content-box;\n    background-color: white;\n    filter: drop-shadow(0 0 1px black);\n    opacity: 1;\n  }\n\n  .videoSeekInput:active::-webkit-slider-thumb {\n    transform: scale(1.25);\n  }\n\n  /* firefox */\n  .videoSeekInput::-moz-focus-outer {\n    border: none;\n  }\n\n  .videoSeekInput::-moz-range-thumb {\n    -moz-appearance: none;\n    appearance: none;\n    box-sizing: border-box;\n    width: 40px;\n    height: 40px;\n    border: 14px solid transparent;\n    border-radius: 100%;\n    background-clip: content-box;\n    background-color: white;\n    filter: drop-shadow(0 0 1px black);\n    opacity: 1;\n  }\n\n  .videoSeekInput:active::-moz-range-thumb {\n    transform: scale(1.25);\n  }\n".trim(),n=document.createElement("template");n.id="seekBar",n.innerHTML=e,document.body.appendChild(n);const o=document.createElement("style");o.innerHTML=t,document.body.appendChild(o)}();const t=[],n=new IntersectionObserver((e=>{e.forEach((e=>{if(!e.isIntersecting)return;const t=e.target;n.unobserve(t),t.play()}))}));e.forEach((e=>{var o,i;!function(e){var t;if(e.getAttribute("src"))return;const n=e.getAttribute("data-srcset");if(!n)return;const o=n.split(", ").map((e=>e.split(" "))).map((([e,t])=>({url:e,width:t}))),i=e.getAttribute("data-sizes")||"",a=i.split(", ").map((e=>{const t=e.lastIndexOf(" ");return{media:e.substring(0,t),width:e.substring(t,e.length)}}));let r;for(const e of a)if(window.matchMedia(e.media).matches){r=parseFloat(e.width.replace("vw",""))/100*document.documentElement.clientWidth*window.devicePixelRatio;break}if(r)for(const t of o){if(parseFloat(t.width.replace("w",""))>=r)return void e.setAttribute("src",t.url)}e.setAttribute("src",null===(t=o[o.length-1])||void 0===t?void 0:t.url)}(e),e.dataset.playbackRate&&(e.playbackRate=parseFloat(e.dataset.playbackRate)||1);const a={},{maybeResetVideoProgress:s,videoStart:d}=function(e,t){const n=e.dataset.trimStartUs,o=e.dataset.trimEndUs,i=null!=n?parseFloat(n)/1e6:0;let a=null!=o?parseFloat(o)/1e6:void 0;e.currentTime=i,e.loop&&i>0&&(e.dataset.loop="true",e.loop=!1);e.addEventListener("timeupdate",(()=>{const t=e.currentTime;let n;null!=a&&t>=a-(r?.25:0)?e.loop||e.dataset.loop?(n=i,e.play()):e.pause():t<i&&(n=i),null!=n&&t!==n&&(e.currentTime=n)}));const s=()=>{var n;isNaN(e.duration)||(null==a&&(a=e.duration),null===(n=t.updateDuration)||void 0===n||n.call(t,i,a))};e.addEventListener("durationchange",s),e.addEventListener("loadedmetadata",s),s();const d=()=>{null!=a&&e.currentTime>=a&&(e.currentTime=i)};return{maybeResetVideoProgress:d,videoStart:i}}(e,a);if(e.autoplay?(e.autoplay=!1,e.paused||e.pause(),n.observe(e)):function(e,t){if(e.getAttribute("poster"))return;e.preload="metadata";const n=t>0?t:.01;if(e.src=`${e.src}#t=${n}`,r&&t>0){const t=e.parentElement||e;t.style.opacity="0",e.addEventListener("seeked",(()=>{t.style.opacity="1"}),{once:!0})}}(e,d),!e.controls)return;const l=null!==(o=e.closest(".video_container"))&&void 0!==o?o:(null!==(i=e.closest("svg"))&&void 0!==i?i:e).closest("div"),{onResizeCallback:c}=function(e,t,n,o,i){const a=window.getComputedStyle(e).position;"relative"!==a&&"absolute"!==a&&(e.style.position="relative");const r=document.createElement("div");e.appendChild(r),r.style.position="absolute",r.style.top=t.getAttribute("data-controls-top")||"0%",r.style.left=t.getAttribute("data-controls-left")||"0%",r.style.width=t.getAttribute("data-controls-width")||"100%",r.style.height=t.getAttribute("data-controls-height")||"100%",t.controls=!1;const{seekBar:s,updateDuration:d}=function(e){const t=document.querySelector("template#seekBar");if(null==t)throw new Error("template does not exist");const n=t.content.firstChild.cloneNode(!0);n.addEventListener("click",(t=>{t.stopPropagation(),"none"===e.preload&&(e.preload="metadata")}));const o=n.querySelector("input");let i=0,a=100;const r=(e,t)=>{i=e,a=t,o.min=e.toString(),o.max=t.toString()};r(i,a),o.addEventListener("input",(t=>{const n=parseFloat(t.target.value);e.currentTime=n})),e.addEventListener("loadedmetadata",(()=>{o.removeAttribute("disabled")}),{once:!0});const s=n.querySelector(".videoSeekBarCurrent");return e.addEventListener("timeupdate",(()=>{o.value=e.currentTime.toString();const t=a-i,n=Math.min((e.currentTime-i)/t*100,100);s.style.width=`${n}%`})),{seekBar:n,updateDuration:r}}(t);i.updateDuration=d,r.appendChild(s),function(e,t){const n=t.querySelector(".soundButton"),o=n.querySelector(".soundOnSvg"),i=n.querySelector(".soundMutedSvg"),a=Number.parseFloat(e.getAttribute("data-volume")||"1");function r(){const t=e.muted||0===e.volume;o.style.display=t?"none":"block",i.style.display=t?"block":"none"}e.addEventListener("volumechange",r),r(),n.addEventListener("click",(()=>{e.muted?(e.muted=!1,e.volume=a):e.volume=e.volume>0?0:a}))}(t,s);const{playButton:l,playPause:c}=function(e,t){let n=!1;const o=document.querySelector("template#playPauseButton");if(null==o)throw new Error("template does not exist");const i=o.content.firstChild.cloneNode(!0),a=Number.parseFloat(e.getAttribute("data-volume")||"1"),r=async o=>{if(n)return;n=!0,o.stopPropagation();const r=i.parentElement.querySelector(".loadingIndicator");try{e.paused?(t(),e.muted&&(e.volume=a,0!==e.volume&&(e.muted=!1)),r.style.display="block",await e.play()):e.pause()}finally{n=!1,r.style.display="none"}};return i.addEventListener("click",r),{playButton:i,playPause:r}}(t,n);r.appendChild(l);const u=l.querySelector(".pauseSvg"),p=l.querySelector(".playSvg"),v=()=>{l.style.opacity="0",u.style.display="block",p.style.display="none"},h=()=>{l.style.opacity="1",u.style.display="none",p.style.display="block"};t.addEventListener("play",v),t.addEventListener("pause",h),t.paused?h():v();const m=()=>{t.paused||(l.style.opacity="1"),s.style.opacity="1"},g=()=>{t.paused||(l.style.opacity="0"),s.style.opacity="0"};r.addEventListener("mouseenter",m),r.addEventListener("mouseover",m),r.addEventListener("mousemove",m),r.addEventListener("mouseleave",g),r.addEventListener("mouseout",g),r.addEventListener("click",c);const y=()=>{const e=r.clientWidth>50&&r.clientHeight>50,t=r.clientWidth>125&&r.clientHeight>100;l.style.visibility=e?"visible":"hidden",s.style.visibility=t?"visible":"hidden"};return{onResizeCallback:y,videoStart:o}}(l,e,s,d,a);t.push(c)})),o((()=>t.forEach((e=>e()))),{runOnLoad:!0})}()}();
!function(){"use strict";const e=Array.from(document.getElementsByTagName("img")),t=e=>{const t=e.parentElement;t&&(t.style.animation="none")};e.forEach((e=>{e.complete?t(e):e.addEventListener("load",(()=>{t(e)}))}))}();
!function(){"use strict";class t{constructor(){this.callbacks=[],window.addEventListener("DOMContentLoaded",(()=>this.onDOMContentLoaded()))}onDOMContentLoaded(){this.callbacks.sort(((t,e)=>t.priority-e.priority)).forEach((({callback:t})=>t()))}runOnLoad(t){"loading"===document.readyState?this.callbacks.push(t):t.callback()}}const e=async t=>{const o=t.classList.contains("animated"),r=()=>window.requestAnimationFrame((()=>t.style.animationPlayState="running"));o&&n(t)?(await a(t),r()):o?r():null!=t.firstElementChild&&e(t.firstElementChild)},n=t=>{const e=t.getElementsByTagName("img").length>0,n=t.getElementsByTagName("video").length>0;return o(t)||e||n},o=t=>{var e;return!!(null===(e=t.textContent)||void 0===e?void 0:e.trim().length)},a=async t=>{const e=[],n=t.getElementsByTagName("img");for(let t=0;t<n.length;t++){const o=n.item(t);e.push(r(o))}const o=t.getElementsByTagName("video");for(let t=0;t<o.length;t++){const n=o.item(t);e.push(s(n))}const a=new Map;document.fonts.forEach((t=>a.set(`${t.family}_${t.style}_${t.weight}`,t)));const l=t.getElementsByTagName("span");for(let t=0;t<l.length;t++){const n=l.item(t);e.push(i(n,a))}return Promise.all(e)},r=t=>new Promise(((e,n)=>{t.complete?e():(t.loading="eager",t.addEventListener("load",(()=>e())),t.addEventListener("error",(()=>n())))})),s=t=>new Promise(((e,n)=>{t.readyState>=2||t.poster?e():(t.addEventListener("loadeddata",(()=>e())),t.addEventListener("error",(()=>n())))})),i=(t,e)=>{const{fontFamily:n,fontStyle:o,fontWeight:a}=getComputedStyle(t),r=e.get(`${n}_${o}_${a}`);return(null==r?void 0:r.loaded)||document.fonts.ready};!function(e,n=Number.MAX_VALUE){var o;(window.canva_scriptExecutor=null!==(o=window.canva_scriptExecutor)&&void 0!==o?o:new t).runOnLoad({callback:e,priority:n})}((()=>{(()=>{const t=document.querySelectorAll(".animation_container");if(0===t.length)return;const n=new IntersectionObserver((t=>{t.forEach((t=>{if(!t.isIntersecting)return;const o=t.target;e(o),n.unobserve(o)}))}),{threshold:.01});t.forEach((t=>n.observe(t)))})()}))}();
!function(){"use strict";function t(t,e){let n;return(...i)=>{clearTimeout(n),n=setTimeout((()=>{t(...i)}),e)}}class e{constructor(){this.callbacks=[],window.addEventListener("DOMContentLoaded",(()=>this.onDOMContentLoaded()))}onDOMContentLoaded(){this.callbacks.sort(((t,e)=>t.priority-e.priority)).forEach((({callback:t})=>t()))}runOnLoad(t){"loading"===document.readyState?this.callbacks.push(t):t.callback()}}function n(t,n=Number.MAX_VALUE){var i;(window.canva_scriptExecutor=null!==(i=window.canva_scriptExecutor)&&void 0!==i?i:new e).runOnLoad({callback:t,priority:n})}class i{constructor(t){this.items=[],this.previousWidth=document.documentElement.clientWidth,this.previousHeight=window.innerHeight;const e=t((()=>this.onWindowResize()),100);window.addEventListener("resize",e)}onWindowResize(){const t=document.documentElement.clientWidth,e=window.innerHeight,n=this.previousWidth!==t,i=this.previousHeight!==e;this.items.forEach((t=>{const e=()=>{t.callback(),t.executed=!0};(!t.executed||n&&t.options.runOnWidthChange||i&&t.options.runOnHeightChange)&&e()})),this.previousWidth=t,this.previousHeight=e}runOnResize(t,e){this.items.push({callback:t,options:e,executed:e.runOnLoad}),this.items.sort(((t,e)=>t.options.priority-e.options.priority)),e.runOnLoad&&n(t,e.priority)}}function o(e,n,o=t){var s;(window.canva_debounceResize=null!==(s=window.canva_debounceResize)&&void 0!==s?s:new i(o)).runOnResize(e,{runOnLoad:!1,runOnWidthChange:!0,runOnHeightChange:!1,priority:Number.MAX_VALUE,...n})}class s{constructor(){this.menuButton=document.getElementById("menuButton"),this.verticalMenu=document.getElementById("verticalMenu"),this.horizontalMenu=document.getElementById("horizontalMenu"),this.menuToggle=document.getElementById("menuToggle"),this.totalWidth=this.horizontalMenu.clientWidth}showHamburgerMenu(){this.menuButton.style.display="flex",this.verticalMenu.style.display="block",this.horizontalMenu.style.display="none",this.horizontalMenu.style.visibility="hidden"}showHorizontalMenu(){this.menuButton.style.display="none",this.verticalMenu.style.display="none",this.horizontalMenu.style.display="flex",this.horizontalMenu.style.visibility="visible"}}n((()=>{if(!(null!=document.getElementById("horizontalMenu")))return;const t=new s;window.addEventListener("hashchange",(()=>{t.menuToggle.checked=!1})),o((()=>function(t){const e=document.body.clientWidth;t.totalWidth>e?t.showHamburgerMenu():t.showHorizontalMenu()}(t)),{runOnLoad:!0})}))}();
!function(){"use strict";function e(e,t){let r;return(...a)=>{clearTimeout(r),r=setTimeout((()=>{e(...a)}),t)}}class t{constructor(){this.callbacks=[],window.addEventListener("DOMContentLoaded",(()=>this.onDOMContentLoaded()))}onDOMContentLoaded(){this.callbacks.sort(((e,t)=>e.priority-t.priority)).forEach((({callback:e})=>e()))}runOnLoad(e){"loading"===document.readyState?this.callbacks.push(e):e.callback()}}function r(e,r=Number.MAX_VALUE){var a;(window.canva_scriptExecutor=null!==(a=window.canva_scriptExecutor)&&void 0!==a?a:new t).runOnLoad({callback:e,priority:r})}class a{constructor(e){this.items=[],this.previousWidth=document.documentElement.clientWidth,this.previousHeight=window.innerHeight;const t=e((()=>this.onWindowResize()),100);window.addEventListener("resize",t)}onWindowResize(){const e=document.documentElement.clientWidth,t=window.innerHeight,r=this.previousWidth!==e,a=this.previousHeight!==t;this.items.forEach((e=>{const t=()=>{e.callback(),e.executed=!0};(!e.executed||r&&e.options.runOnWidthChange||a&&e.options.runOnHeightChange)&&t()})),this.previousWidth=e,this.previousHeight=t}runOnResize(e,t){this.items.push({callback:e,options:t,executed:t.runOnLoad}),this.items.sort(((e,t)=>e.options.priority-t.options.priority)),t.runOnLoad&&r(e,t.priority)}}function i(t,r,i=e){var n;(window.canva_debounceResize=null!==(n=window.canva_debounceResize)&&void 0!==n?n:new a(i)).runOnResize(t,{runOnLoad:!1,runOnWidthChange:!0,runOnHeightChange:!1,priority:Number.MAX_VALUE,...r})}class n extends Error{}class o extends n{}class s extends n{}class c extends n{}class u extends n{}class l extends n{}class h extends n{}let d=0;function f(){return d++}class g{constructor(e){this.geometry=e.geometry,this.shader=e.shader,this.attributes=e.attributes,this.textures=e.textures,this.uniforms=e.uniforms,this.renderTarget=e.renderTarget,this.enableBlend=e.enableBlend}}class m{constructor(e){this.resources=new Map,this.create=e,this.backend=this.createBackend()}createBackend(){const e=this.create();return e.onContextLost=()=>{var e;null===(e=this.onContextLost)||void 0===e||e.call(this)},e}load(e){this.backend.load(e);const t=Array.isArray(e)?e:e.resources;for(const e of t)this.resources.set(e.id,e)}update(e){this.backend.update(e)}clear(e,t){this.backend.clear(e,t)}render(e){this.backend.render(e)}flush(){this.backend.flush()}release(e){this.backend.release(e);const t=Array.isArray(e)?e:e.resources;for(const e of t)this.resources.delete(e.id)}dispose(){this.backend.dispose(),this.resources.clear()}restore(){this.backend.dispose(),this.backend=this.createBackend(),this.backend.load(Array.from(this.resources.values()))}resize(e,t){if(e===this.canvas.width&&t===this.canvas.height)return;this.backend.resize(e,t);const r=Array.from(this.resources.values()).filter((e=>"texture"===e.resourceType&&!e.source&&"relative"===e.size));this.backend.update(r)}get canvas(){return this.backend.canvas}}class v{constructor(e){this.id=f(),this.resourceType="shader",this.vertexSource=e.vertexSource,this.fragmentSource=e.fragmentSource}}const b="preserve",p="fixed";class x{constructor(e){this.id=f(),this.resourceType="texture",this.textureType="image",this.size=p,this.colorFormat="rgba",this.numberFormat="u8",this.source=e.source,this.name=e.name,this.alpha=e.alpha||b}get width(){return this.source.width}get height(){return this.source.height}}class w{constructor(e){this.id=f(),this.resourceType="texture",this.textureType="binary",this.size=p,this.source=e.source,this.name=e.name,this.alpha=e.alpha||b,this.width=e.width,this.height=e.height}get colorFormat(){const e=this.source.length/(this.width*this.height);if(3===e)return"rgb";if(4===e)return"rgba";throw new l(`Invalid number of color channels for binary texture with ID: ${this.id}. Number of channels must be 3 (RGB) or 4 (RGBA) but the provided data has ${e} channels.`)}get numberFormat(){return this.source instanceof Uint8Array?"u8":"f32"}}class y{constructor(e){this.id=f(),this.resourceType="texture",this.textureType="render",this.source=null,this.name=e.name,this.alpha=e.alpha||b,this.width=e.width||0,this.height=e.height||0,this.size=e.size||p,this.colorFormat=e.colorFormat,this.numberFormat=e.numberFormat}}function T(e,t){const r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW);const a=new Map;for(const[r,i]of Object.entries(t.accessors)){const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,i.buffer,e.STATIC_DRAW),a.set(r,t)}return e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),{indices:r,buffers:a}}const R=new Map([["i8",5120],["i16",5122],["u8",5121],["u16",5123],["f32",5126]]),E={FLOAT:{type:"float",name:"float",length:1},VEC2:{type:"float",name:"vec2",length:2},VEC3:{type:"float",name:"vec3",length:3},VEC4:{type:"float",name:"vec4",length:4}},C={MAT2:{type:"matrix",name:"mat2",length:4},MAT3:{type:"matrix",name:"mat3",length:9},MAT4:{type:"matrix",name:"mat4",length:16}},A={INT:{type:"int",name:"int",length:1},IVEC2:{type:"int",name:"ivec2",length:2},IVEC3:{type:"int",name:"ivec3",length:3},IVEC4:{type:"int",name:"ivec4",length:4},SAMPLER2D:{type:"int",name:"sampler2D",length:1}},F=new Map([[5126,E.FLOAT],[35664,E.VEC2],[35665,E.VEC3],[35666,E.VEC4],[35674,C.MAT2],[35675,C.MAT3],[35676,C.MAT4],[5124,A.INT],[35667,A.IVEC2],[35668,A.IVEC3],[35669,A.IVEC4],[35678,A.SAMPLER2D]]);class _{constructor(e,t,r){this.name=e.name,this.location=t;const a=F.get(e.type);if(!a)throw new l(`Type of uniform '${e.name}' is not supported.`);this.meta=a,this._data=this.parseData(r)}parseData(e){if(!e)return new Array(this.meta.length).fill(0);if(e.length!==this.meta.length)throw new l(`Could not set uniform '${this.meta.type} ${this.name}'. Expected data with a length of ${this.meta.length} but your data has a length of ${e.length}.`);return e}equals(e){const t=this._data,r=e;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==r[e])return!1;return!0}get data(){return this._data}set data(e){this._data=this.parseData(e)}}function D(e,t){const{meta:r,name:a,location:i,data:n}=t;if("int"===r.type)switch(r.length){case 1:e.uniform1iv(i,n);break;case 2:e.uniform2iv(i,n);break;case 3:e.uniform3iv(i,n);break;case 4:e.uniform4iv(i,n);break;default:throw new l(`Could not set the value for uniform '${a}'. Make sure its length is between 1 and 4 (inclusive).`)}else if("float"===r.type)switch(r.length){case 1:e.uniform1fv(i,n);break;case 2:e.uniform2fv(i,n);break;case 3:e.uniform3fv(i,n);break;case 4:e.uniform4fv(i,n);break;default:throw new l(`Could not set the value for uniform '${a}'. Make sure its length is between 1 and 4 (inclusive).`)}else switch(r.length){case 4:e.uniformMatrix2fv(i,!1,n);break;case 9:e.uniformMatrix3fv(i,!1,n);break;case 16:e.uniformMatrix4fv(i,!1,n);break;default:throw new l(`Could not set the value for uniform '${a}'. Make sure its length is between 2 and 4 (inclusive).`)}}function B(e,t,r){const a=function(e){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);if(!t)return!1;return t.precision>10}(e);a&&(r=function(e){return e.replace("precision mediump float;","precision highp float;")}(r));const i=e.createShader(t);if(!i)throw new s("Could not create shader");e.shaderSource(i,r),e.compileShader(i);if(e.getShaderParameter(i,e.COMPILE_STATUS))return i;{const r=e.getShaderInfoLog(i);e.deleteShader(i);const a=t===e.VERTEX_SHADER?"vertex":"fragment";throw new o(`Could not compile ${a} shader. Details: ${r}`)}}function M(e,t){const r=function(e,t,r){const a=e.createProgram();if(!a)throw new s("Could not create program");const i=B(e,e.VERTEX_SHADER,t),n=B(e,e.FRAGMENT_SHADER,r);if(e.attachShader(a,i),e.attachShader(a,n),e.linkProgram(a),e.deleteShader(i),e.deleteShader(n),e.getProgramParameter(a,e.LINK_STATUS))return a;throw new o(`Could not link program. Details: ${e.getProgramInfoLog(a)}`)}(e,t.vertexSource,t.fragmentSource);e.useProgram(r);const a=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),i=new Map;for(let t=0;t<a;t++){const a=e.getActiveAttrib(r,t),n=a?e.getAttribLocation(r,a.name):-1;if(!a||-1===n)throw new h(`Could not cache attribute. Could not find attribute or location at index ${t}. This is likely a bug with the renderer.`);const o=F.get(a.type);if(!o)throw new l(`Type of attribute '${a.name}' is not supported.`);e.enableVertexAttribArray(n),i.set(a.name,{location:n,meta:o})}const n=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),c=new Map,u=new Map;let d=0;for(let t=0;t<n;t++){const a=e.getActiveUniform(r,t),i=a?e.getUniformLocation(r,a.name):null;if(!a||!i)throw new h(`Could not cache uniform. Could not find uniform or location at index ${t}. This is likely a bug with the renderer.`);if(a.type===e.SAMPLER_2D||a.type===e.SAMPLER_CUBE){const t=new _(a,i,[d]);c.set(t.name,t),D(e,t),d++}else{const t=new _(a,i);u.set(t.name,t),D(e,t)}}return e.useProgram(null),{program:r,attributes:i,textures:c,uniforms:u}}function P(e,t){return function(e,t){return{width:"fixed"===e.size?e.width||t.width:(e.width||1)*t.width,height:"fixed"===e.size?e.height||t.height:(e.height||1)*t.height}}(t,{width:e.drawingBufferWidth,height:e.drawingBufferHeight})}function L(e,t,r){if(e instanceof WebGLRenderingContext&&"f32"===t.numberFormat&&!e.getExtension("OES_texture_float"))throw new u("No support for floating point textures");const a=r||e.createTexture();if(!a)throw new s(`Could not create WebGLTexture for texture with ID: '${t.id}'.`);e.bindTexture(e.TEXTURE_2D,a),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,"premultiply"===t.alpha);const i="rgb"===t.colorFormat?e.RGB:e.RGBA,n="f32"===t.numberFormat?e.FLOAT:e.UNSIGNED_BYTE,o="f32"===t.numberFormat?e.NEAREST:e.LINEAR;if("image"!==t.textureType){let r;r=e instanceof WebGLRenderingContext?i:i===e.RGB?n===e.FLOAT?e.RGB32F:e.RGB:n===e.FLOAT?e.RGBA32F:e.RGBA;const{width:a,height:o}=P(e,t);e.texImage2D(e.TEXTURE_2D,0,r,a,o,0,i,n,t.source)}else"tagName"in(c=t.source)&&"IMG"===c.tagName&&function(e){const t=document.createElement("a");return t.href=e,"data:"!==t.protocol&&"blob:"!==t.protocol}(t.source.src)&&!t.source.crossOrigin&&console.warn(`Fragl warning: ${t.source.src} image may come from a different origin but you did not set the crossOrigin attribute.`),e.texImage2D(e.TEXTURE_2D,0,i,i,n,t.source);var c;return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),a}class k{constructor(e,t){var r,a;this.geometryCache=new Map,this.shaderCache=new Map,this.textureCache=new Map,this.handleContextLost=()=>{this.onContextLost&&this.onContextLost()},this.container=e,this.env=(null==t?void 0:t.env)||window,this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.width=((null==t?void 0:t.width)||this.canvas.clientWidth)*this.env.devicePixelRatio,this.canvas.height=((null==t?void 0:t.height)||this.canvas.clientHeight)*this.env.devicePixelRatio,this.canvas.addEventListener("webglcontextlost",this.handleContextLost,{once:!0});let i="Unknown";const n=e=>{e.statusMessage&&(i=e.statusMessage)};this.canvas.addEventListener("webglcontextcreationerror",n);const o={alpha:null===(r=null==t?void 0:t.alpha)||void 0===r||r,antialias:null===(a=null==t?void 0:t.antialias)||void 0===a||a,depth:!1,stencil:!1,preserveDrawingBuffer:!!(null==t?void 0:t.preserveDrawingBuffer),powerPreference:"high-performance"},c=(null==t?void 0:t.useWebGl2)?this.canvas.getContext("webgl2",o):this.canvas.getContext("webgl",o);if(this.canvas.removeEventListener("webglcontextcreationerror",n),!c)throw new s(`A WebGL context could not be created. Reason: ${i}`);this.gl=c,this.fbo=c.createFramebuffer()}flush(){this.gl.flush()}resize(e,t){this.canvas.width=(e||this.canvas.clientWidth)*this.env.devicePixelRatio,this.canvas.height=(t||this.canvas.clientHeight)*this.env.devicePixelRatio}load(e){const t=this.gl,r=Array.isArray(e)?e:e.resources;for(const e of r)if("shader"===e.resourceType){if(this.shaderCache.has(e.id))continue;this.shaderCache.set(e.id,M(t,e))}else if("geometry"===e.resourceType){if(this.geometryCache.has(e.id))continue;this.geometryCache.set(e.id,T(t,e))}else{if(this.textureCache.has(e.id))continue;this.textureCache.set(e.id,L(t,e))}}update(e){const t=this.gl,r=Array.isArray(e)?e:e.resources;for(const e of r)if("texture"===e.resourceType){const r=this.textureCache.get(e.id);if(!r)throw new c(`Could not update texture with ID: '${e.id}'. Did you remember to use load()?`);L(t,e,r)}}clear(e,t){const r=this.gl;if(t){const e=this.textureCache.get(t.id);if(!e)throw new c(`Could not find render target with ID: ${t.id}. Did you remember to use load()?`);r.bindFramebuffer(r.FRAMEBUFFER,this.fbo),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)}else r.bindFramebuffer(r.FRAMEBUFFER,null);r.clearColor(...e),r.clear(r.COLOR_BUFFER_BIT)}render(e){var t,r;const a=this.gl,i=Array.isArray(e)?e:e.renderables;for(const e of i){const i=this.shaderCache.get(e.shader.id);if(!i)throw new c(`Could not find shader with ID: ${e.shader.id}. Did you remember to use load()?`);e.enableBlend?(a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA)):a.disable(a.BLEND),a.useProgram(i.program);const n=this.geometryCache.get(e.geometry.id);if(!n)throw new c(`Could not find geometry with ID: ${e.geometry.id}. Did you remember to use load()?`);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n.indices);const o=!!e.geometry.instances,s=o?a.getExtension("ANGLE_instanced_arrays"):null;if(o&&!s)throw new u("Instancing is required but not supported on this device");for(const[c,{location:u,meta:l}]of i.attributes.entries()){const i=e.attributes[c],d=R.get(i.type);if(!d)throw new h(`Could not determine type for attribute ${c}. This is likely a bug with the renderer.`);const f=n.buffers.get(i.name);if(!f)throw new h(`Could not locate geometry buffer "${i.name}. This is likely a bug with the renderer`);a.bindBuffer(a.ARRAY_BUFFER,f),a.vertexAttribPointer(u,l.length,d,null!==(t=i.normalized)&&void 0!==t&&t,null!==(r=i.stride)&&void 0!==r?r:0,i.offset),o&&i.divisor&&s.vertexAttribDivisorANGLE(u,i.divisor)}const d={...e.uniforms,...this.commonUniforms};for(const[e,t]of i.uniforms.entries()){const r=d[e];if(!r)throw new l(`Could not find a value for uniform '${e}'. Make sure you provide a value.`);t.equals(r)||(t.data=r,D(a,t))}for(const[t,r]of i.textures.entries()){a.activeTexture(a.TEXTURE0+r.data[0]),a.bindTexture(a.TEXTURE_2D,null);const i=e.textures[t];if(!i)throw new l(`Could not find a texture associated with uniform '${t}'. Make sure you provide a value.`);const n=this.textureCache.get(i.id);if(!n)throw new c(`Could not find texture with ID: ${i.id}. Did you remember to use load()?`);a.bindTexture(a.TEXTURE_2D,n)}if(e.renderTarget){const t=this.textureCache.get(e.renderTarget.id);if(!t)throw new c(`Could not find render target with ID: ${e.renderTarget.id}. Did you remember to use load()?`);const{width:r,height:i}=P(a,e.renderTarget);a.bindFramebuffer(a.FRAMEBUFFER,this.fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),a.viewport(0,0,r,i)}else a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);o?s.drawElementsInstancedANGLE(a.TRIANGLES,e.geometry.indices.length,a.UNSIGNED_SHORT,0,e.geometry.instances):a.drawElements(a.TRIANGLES,e.geometry.indices.length,a.UNSIGNED_SHORT,0)}}release(e){const t=Array.isArray(e)?e:e.resources;for(const e of t)this.deleteResource(e.id,e.resourceType)}dispose(){const e=this.gl;for(const e of this.geometryCache.keys())this.deleteResource(e,"geometry");for(const e of this.shaderCache.keys())this.deleteResource(e,"shader");for(const e of this.textureCache.keys())this.deleteResource(e,"texture");this.geometryCache.clear(),this.shaderCache.clear(),this.textureCache.clear(),e.deleteFramebuffer(this.fbo),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<t;r++)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null);this.canvas.width=this.canvas.height=0,this.canvas.removeEventListener("webglcontextlost",this.handleContextLost),this.canvas.remove()}deleteResource(e,t){const r=this.gl;if("shader"===t){const t=this.shaderCache.get(e);r.deleteProgram((null==t?void 0:t.program)||null),this.shaderCache.delete(e)}else if("geometry"===t){const t=this.geometryCache.get(e)||null;if(t){for(const e of Object.values(t.buffers))r.bindBuffer(r.ARRAY_BUFFER,e),r.bufferData(r.ARRAY_BUFFER,1,r.STATIC_DRAW),r.deleteBuffer(e);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indices),r.bufferData(r.ELEMENT_ARRAY_BUFFER,1,r.STATIC_DRAW),r.deleteBuffer(t.indices)}this.geometryCache.delete(e)}else{const t=this.textureCache.get(e);r.deleteTexture(t||null),this.textureCache.delete(e)}}get commonUniforms(){return{uResolution:[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight],uViewSize:[this.canvas.clientWidth,this.canvas.clientHeight],uDevicePixelRatio:[this.env.devicePixelRatio]}}}const I="uPrevResult",U=new class{constructor(e){this.id=f(),this.resourceType="geometry";for(const[t,r]of Object.entries(e.accessors))r.name=t;this.accessors=e.accessors,this.indices=e.indices,this.instances=e.instances}}({accessors:{position:{type:"f32",offset:0,buffer:new Float32Array([-1,-1,-1,1,1,-1,1,1])}},indices:new Uint16Array([0,3,1,0,2,3])}),S={aPosition:U.accessors.position};function O(e){return`\nattribute vec2 aPosition;\nvarying vec2 vTexCoord;\n\nvoid main()\n{\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n    vTexCoord = aPosition * 0.5 + 0.5;\n    ${e?"vTexCoord.y = 1.0 - vTexCoord.y;":""}\n}\n  `}function N(e){return t=e,Array.isArray(t)?e:[e];var t}function z(e,t,r,a){return new y({name:e,width:t,height:r,size:a||"relative",colorFormat:"rgba",numberFormat:"u8"})}class ${constructor(e){this.index=0,this.buffers=null!=e?e:[new y({colorFormat:"rgba",numberFormat:"u8"}),new y({colorFormat:"rgba",numberFormat:"u8"})]}currentBuffer(){return this.buffers[this.index]}nextBuffer(){return this.index=(this.index+1)%this.buffers.length,this.buffers[this.index]}}class G{static createPingpongBuffers({width:e,height:t,size:r}={}){return new $([z("bufferA",e,t,r),z("bufferB",e,t,r)])}constructor(e){var t,r,a,i,n,o,s,c,u;if(this.allRenderables=[],this.renderablePassMap=new Map,this.uniforms={},this.renderTarget=null===(t=e.options)||void 0===t?void 0:t.renderTarget,e.uniforms)for(const[t,r]of Object.entries(e.uniforms))this.uniforms[t]=N(r);const h=[];for(let t=0;t<e.passes.length;t++){const r=e.passes[t];"string"==typeof r?h.push({fragment:r}):h.push(r)}this.buffers=(null===(r=e.options)||void 0===r?void 0:r.buffers)||G.createPingpongBuffers(null===(a=e.options)||void 0===a?void 0:a.renderTarget);const d=new Set;for(const e of h)if(e.inputs){for(const t of e.inputs){if(t===I)throw new l(`Your render pass should not define ${I}. This will be automatically added.`);d.add(t)}e.output&&d.add(e.output)}const f=new Map;for(const t of d)f.set(t,z(t,null===(n=null===(i=e.options)||void 0===i?void 0:i.renderTarget)||void 0===n?void 0:n.width,null===(s=null===(o=e.options)||void 0===o?void 0:o.renderTarget)||void 0===s?void 0:s.height,null===(u=null===(c=e.options)||void 0===c?void 0:c.renderTarget)||void 0===u?void 0:u.size));this.createRenderables(h,e,f)}createRenderables(e,t,r){var a;e.forEach((e=>{const a=this.createRenderable(e,t,r);this.renderablePassMap.set(a,e),this.allRenderables.push(a)})),(null===(a=t.options)||void 0===a?void 0:a.renderTarget)||this.allRenderables.push(new g({geometry:U,shader:new v({vertexSource:O(!0),fragmentSource:`precision mediump float;\n\nuniform sampler2D ${I};\nvarying vec2 vTexCoord;\n\nvoid main()\n{\n    gl_FragColor = texture2D(${I}, vTexCoord);\n    gl_FragColor.rgb *= gl_FragColor.a;\n}\n  `}),attributes:S,textures:{[I]:this.buffers.currentBuffer()},uniforms:this.uniforms})),this.rewireRenderables(this.allRenderables)}createRenderable(e,t,r){const a={...t.textures},i=new g({geometry:U,textures:a,attributes:S,uniforms:this.uniforms,shader:new v({vertexSource:O(),fragmentSource:e.fragment})});if(e.inputs)for(const t of e.inputs){const e=r.get(t);if(!e)throw new l(`Unable to assign texture input. Could not find texture '${t}'.`);a[t]=e}if(e.output){const t=r.get(e.output);if(!t)throw new l(`Unable to assign texture output. Could not find texture '${e.output}'.`);i.renderTarget=t}return i}update(e){if(e.textures)for(const[t,r]of Object.entries(e.textures))if(r)for(const e of this.allRenderables)e.textures[t]=r;if(e.uniforms)for(const[t,r]of Object.entries(e.uniforms))this.uniforms[t]&&(this.uniforms[t]=N(r))}get resources(){const e=new Set,t=new Set,r=new Set;for(const a of this.allRenderables){e.add(a.geometry),t.add(a.shader);for(const e of Object.values(a.textures))r.add(e);a.renderTarget&&r.add(a.renderTarget)}return[...e,...t,...r]}get renderables(){const e=Object.fromEntries(Object.entries(this.uniforms).map((([e,t])=>[e,1===t.length?t[0]:t]))),t=this.allRenderables.filter((t=>{var r;const a=null===(r=this.renderablePassMap.get(t))||void 0===r?void 0:r.shouldRender;return!a||a(e)}));return this.rewireRenderables(t),t}rewireRenderables(e){const t=e=>{var t;e.textures[I]=this.buffers.currentBuffer();(null===(t=this.renderablePassMap.get(e))||void 0===t?void 0:t.output)||(e.renderTarget=this.buffers.nextBuffer())},r=e=>{e.textures[I]=this.buffers.currentBuffer(),this.renderTarget&&(e.renderTarget=this.renderTarget)};e.forEach(((a,i)=>{i===e.length-1?r(a):t(a)}))}}class H{constructor(e,t){this.ps=e,this.xs=t}static fromPoints(e){const t=e.length,r=new Float64Array(t),a=new Float64Array(t);for(let i=1;i<t-1;i++){const t=e[i-1],n=e[i],o=e[i+1],s=o.x-t.x,c=(n.x-t.x)/s,u=c*a[i-1]+2,l=(o.y-n.y)/(o.x-n.x)-(n.y-t.y)/(n.x-t.x);r[i]=(6*l/s-c*r[i-1])/u,a[i]=(c-1)/u}for(let e=t-2;e>=0;--e)a[e]=a[e]*a[e+1]+r[e];return new H(e,a)}interpolate(e){const{ps:t,xs:r}=this;let a=0,i=this.ps.length-1;for(;i-a>1;){const r=i+a>>1;t[r].x>e?i=r:a=r}const n=t[i],o=t[a],s=n.x-o.x,c=(n.x-e)/s,u=(e-o.x)/s,l=r[a],h=r[i];return c*o.y+u*n.y+(l*(c**3-c)+h*(u**3-u))*s**2/6}}const W="x",X="C",j=new RegExp("^([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?([0-9a-fA-F]{2})?$");const V=Object.freeze({brightness:0,contrast:0,saturation:0,tint:0,tintAmount:50,blur:0,xpro:0,warmth:0,clarity:0,vibrance:0,highlights:0,shadows:0,vignette:0,fade:0});function Y(e){if(!function(e){if(!j.test(e))return!1;const t=[...Array(14).keys()].map((e=>2*e)).map((t=>t<e.length?parseInt(e.substring(t,t+2),16):null)),r=e=>Number.isFinite(e);return(null==t[0]||r(t[0]-100))&&(null==t[1]||r(t[1]-100))&&(null==t[2]||r(t[2]-100))&&(null==t[3]||r(t[3]-100))&&(null==t[4]||r(t[4]-100))&&(null==t[5]||r(t[5]))&&(null==t[6]||r(t[6]-100))&&(null==t[7]||r(t[7]))&&(null==t[8]||r(t[8]-100))&&(null==t[9]||r(t[9]))&&(null==t[10]||r(t[10]))&&(null==t[11]||r(t[11]-100))&&(null==t[12]||r(t[12]-100))&&(null==t[13]||r(t[13]))}(e))return V;const t=[...Array(14).keys()].map((e=>2*e)).map((t=>t<e.length?parseInt(e.substring(t,t+2),16):null));return{...V,...null!=t[0]&&{brightness:t[0]-100},...null!=t[1]&&{contrast:t[1]-100},...null!=t[2]&&{saturation:t[2]-100},...null!=t[3]&&{tint:t[3]-100},...null!=t[4]&&{blur:t[4]-100},...null!=t[5]&&{vignette:t[5]},...null!=t[6]&&{xpro:t[6]-100},...null!=t[7]&&{tintAmount:t[7]},...null!=t[8]&&{warmth:t[8]-100},...null!=t[9]&&{clarity:t[9]},...null!=t[10]&&{vibrance:t[10]},...null!=t[11]&&{highlights:t[11]-100},...null!=t[12]&&{shadows:t[12]-100},...null!=t[13]&&{fade:t[13]}}}const q=["precision mediump float;uniform sampler2D a;varying highp vec2 vTexCoord;uniform int d;void main(){if(d==0){gl_FragColor=texture2D(a,vTexCoord);return;}vec2 b=vec2(vTexCoord.x,vTexCoord.y/2.-1e-3);vec4 e=texture2D(a,b);vec2 c=vec2(vTexCoord.x,vTexCoord.y/2.+.499);vec4 f=texture2D(a,c);gl_FragColor=vec4(f.rgb,e.r);}","precision mediump float;uniform float D,E,F;uniform vec3 G;uniform sampler2D uPrevResult;varying vec2 vTexCoord;vec4 V(vec4 a,float b){return vec4(a.rgb+b,a.a);}vec4 W(vec4 b,float a){float c=a>0.?1./(1.-a):1.+a;return vec4((b.rgb-.5)*c+.5,b.a);}vec4 X(vec4 c,float a){vec3 d=vec3(.3086,.6094,.082),b=vec3(1.-a)*d;mat3 e=mat3(vec3(b.x)+vec3(a,0,0),vec3(b.y)+vec3(0,a,0),vec3(b.z)+vec3(0,0,a));return vec4(max(vec3(0),e*c.rgb),c.a);}vec4 Y(vec4 a,vec3 b){return vec4(a.rgb-(a.rgb-b)*.1,a.a);}void main(){gl_FragColor=texture2D(uPrevResult,vTexCoord);if(D!=0.)gl_FragColor=clamp(V(gl_FragColor,D),0.,1.);if(E!=0.)gl_FragColor=clamp(W(gl_FragColor,E),0.,1.);if(F!=1.)gl_FragColor=clamp(X(gl_FragColor,F),0.,1.);if(G!=vec3(0.,0.,0.))gl_FragColor=Y(gl_FragColor,G);}",{fragment:"precision mediump float;uniform float s;uniform vec2 uResolution;uniform sampler2D uPrevResult;varying vec2 vTexCoord;float h(float b,float a){return .39894*exp(-.5*pow(b/a,2.))/a;}vec4 t(sampler2D d,vec2 e,vec2 q,float b){float f=0.;vec4 g=vec4(0.);vec2 r=1./uResolution;float c=h(0.,b);vec4 k=texture2D(d,e);k.rgb*=k.a,g+=k*c,f+=c;float u=b*2.5;for(float a=1.;a<=200.;a+=2.){if(a>u)break;float i=a+1.,l=h(a,b),m=h(i,b);c=l+m;vec2 j=q*(a*l+i*m)/c*r;vec4 n=texture2D(d,e+j),o=texture2D(d,e-j);n.rgb*=n.a,o.rgb*=o.a,g+=(n+o)*c,f+=c*2.;}vec4 p=g/f;p.rgb/=p.a;return p;}void main(){if(s==0.){gl_FragColor=texture2D(uPrevResult,vTexCoord);return;}gl_FragColor=t(uPrevResult,vTexCoord,vec2(1.,0.),s);}",output:X},{fragment:"precision mediump float;uniform float s;uniform vec2 uResolution;uniform sampler2D C,uPrevResult;varying vec2 vTexCoord;float h(float b,float a){return .39894*exp(-.5*pow(b/a,2.))/a;}vec4 t(sampler2D d,vec2 e,vec2 q,float b){float f=0.;vec4 g=vec4(0.);vec2 r=1./uResolution;float c=h(0.,b);vec4 k=texture2D(d,e);k.rgb*=k.a,g+=k*c,f+=c;float u=b*2.5;for(float a=1.;a<=200.;a+=2.){if(a>u)break;float i=a+1.,l=h(a,b),m=h(i,b);c=l+m;vec2 j=q*(a*l+i*m)/c*r;vec4 n=texture2D(d,e+j),o=texture2D(d,e-j);n.rgb*=n.a,o.rgb*=o.a,g+=(n+o)*c,f+=c*2.;}vec4 p=g/f;p.rgb/=p.a;return p;}void main(){if(s==0.){gl_FragColor=texture2D(uPrevResult,vTexCoord);return;}gl_FragColor=t(C,vTexCoord,vec2(0.,1.),s);}",inputs:[X],output:W},{fragment:"precision mediump float;uniform float s,H,I,J;uniform sampler2D x,uPrevResult,z,A;varying vec2 vTexCoord;vec4 Z(vec4 a,vec4 c,float b){return b<=0.?a:mix(c,a,1.+b/20.);}vec4 _(vec4 a,float b){a.rgb=b>0.?mix(a.rgb,vec3(texture2D(A,vec2(a.r,.5)).r,texture2D(A,vec2(a.g,.5)).g,texture2D(A,vec2(a.b,.5)).b),b):mix(a.rgb,vec3(texture2D(z,vec2(a.r,.5)).r,texture2D(z,vec2(a.g,.5)).g,texture2D(z,vec2(a.b,.5)).b),-b);return a;}vec4 aa(vec4 a,float b){return vec4(a.r+b,a.g,a.b-b,a.a);}void main(){gl_FragColor=s==0.?texture2D(uPrevResult,vTexCoord):texture2D(x,vTexCoord);if(H!=0.){vec4 a=texture2D(uPrevResult,vTexCoord);gl_FragColor=clamp(Z(a,gl_FragColor,H),0.,1.);}if(J!=0.)gl_FragColor=clamp(_(gl_FragColor,J),0.,1.);if(I!=0.)gl_FragColor=aa(gl_FragColor,I);}",inputs:[W]},{fragment:"precision mediump float;uniform float v;uniform vec2 uResolution;uniform sampler2D uPrevResult;varying vec2 vTexCoord;float h(float b,float a){return .39894*exp(-.5*pow(b/a,2.))/a;}vec4 t(sampler2D d,vec2 e,vec2 q,float b){float f=0.;vec4 g=vec4(0.);vec2 r=1./uResolution;float c=h(0.,b);vec4 k=texture2D(d,e);k.rgb*=k.a,g+=k*c,f+=c;float u=b*2.5;for(float a=1.;a<=200.;a+=2.){if(a>u)break;float i=a+1.,l=h(a,b),m=h(i,b);c=l+m;vec2 j=q*(a*l+i*m)/c*r;vec4 n=texture2D(d,e+j),o=texture2D(d,e-j);n.rgb*=n.a,o.rgb*=o.a,g+=(n+o)*c,f+=c*2.;}vec4 p=g/f;p.rgb/=p.a;return p;}void main(){if(v==0.){gl_FragColor=texture2D(uPrevResult,vTexCoord);return;}gl_FragColor=t(uPrevResult,vTexCoord,vec2(1.,0.),15.);}",output:X},{fragment:"precision mediump float;uniform float v;uniform vec2 uResolution;uniform sampler2D C,uPrevResult;varying vec2 vTexCoord;float h(float b,float a){return .39894*exp(-.5*pow(b/a,2.))/a;}vec4 t(sampler2D d,vec2 e,vec2 q,float b){float f=0.;vec4 g=vec4(0.);vec2 r=1./uResolution;float c=h(0.,b);vec4 k=texture2D(d,e);k.rgb*=k.a,g+=k*c,f+=c;float u=b*2.5;for(float a=1.;a<=200.;a+=2.){if(a>u)break;float i=a+1.,l=h(a,b),m=h(i,b);c=l+m;vec2 j=q*(a*l+i*m)/c*r;vec4 n=texture2D(d,e+j),o=texture2D(d,e-j);n.rgb*=n.a,o.rgb*=o.a,g+=(n+o)*c,f+=c*2.;}vec4 p=g/f;p.rgb/=p.a;return p;}void main(){if(v==0.){gl_FragColor=texture2D(uPrevResult,vTexCoord);return;}gl_FragColor=t(C,vTexCoord,vec2(0.,1.),15.);}",inputs:[X],output:W},{fragment:"precision mediump float;uniform float v,K,L,M,N,O;uniform vec2 uResolution;uniform sampler2D B,x,uPrevResult;varying vec2 vTexCoord;const mat4 y=mat4(.255,.341,.105,0.,.652,-.465,.319,0.,.093,.125,-.424,0.,0.,.5,.5,1.),P=mat4(1.,1.,1.,0.,1.944,-.748,-.08,0.,.793,0.,-2.161,0.,-1.368,.374,1.121,1.);float Q(vec3 a){vec3 b=vec3(.2125,.7154,.0721);return dot(a,b);}float R(in vec2 a){a=a*2.-1.,a.y*=1.25-.5*step(0.,a.y),a.xy*=a.xy,a.xy=clamp(a.xy,0.,1.),a*=255.,a=floor(a);return sqrt(clamp(a.x+a.y,0.,255.)/255.);}vec4 S(vec4 c,float a){vec3 d=vec3(.2125,.7154,.0721),b=vec3(1.-a)*d;mat3 e=mat3(vec3(b.x)+vec3(a,0,0),vec3(b.y)+vec3(0,a,0),vec3(b.z)+vec3(0,0,a));return vec4(clamp(e*c.rgb,0.,1.),c.a);}float T(in float a){return pow(1.-a,3.);}vec4 ba(vec4 a,float c){const mat3 d=mat3(.334,0,-.5,.333,.434,.25,.333,-.433,.251);vec3 b=d*a.rgb;b.gb+=.5;float e=R(b.gb),f=T(clamp(e,0.,1.));vec4 g=f*a,i=S(g,1.+c);return a.a*i+(1.-i.a)*a;}float w(float c,float a,float d,float b,float e){return b+(e-b)*(c-a)/(d-a);}float U(float a){float c=1.-step(.1429,a),d=step(.1429,a)-step(.2857,a),e=step(.2857,a)-step(.7143,a),f=step(.7143,a)-step(.8571,a),g=step(.8571,a),b=w(a,0.,.1429,0.,.75)*c;b+=w(a,.1429,.2857,.75,1.)*d,b+=w(a,.2857,.7143,1.,1.)*e,b+=w(a,.7143,.8571,1.,.75)*f,b+=w(a,.8571,1.,.75,0.)*g;return b;}vec4 ca(vec4 a,vec2 e,float f){float g=Q(a.rgb);vec4 b=vec4(a.rgb,a.a*U(g)),d=texture2D(x,e);b.rgb*=b.a,a.rgb*=a.a,d.a=1.;vec4 c=mix(d,b,1.+f);c=clamp(c,0.,1.),a=a.a*c+(1.-c.a)*a,a.rgb/=a.a;return a;}vec4 da(vec4 b,float c){vec4 a=y*b;float d=.8*step(0.,c)+.2,e=pow(a.r,3.),f=clamp(a.r*(1.+c*d),0.,1.);a.r=mix(a.r,f,e),b=P*a,b.r=clamp(b.r,0.,1.);return b;}vec4 ea(vec4 b,float c){vec4 a=y*b;float d=pow(1.-a.r,3.),e=clamp(a.r*(1.+c),0.,1.);a.r=mix(a.r,e,d),b=P*a,b.r=clamp(b.r,0.,1.);return b;}vec4 fa(vec4 a,float b){return vec4(mix(a.rgb,vec3(texture2D(B,vec2(a.r,.5)).r,texture2D(B,vec2(a.g,.5)).g,texture2D(B,vec2(a.b,.5)).b),b),a.a);}vec4 ga(vec4 b,vec2 d,vec2 a,float f){b.rgb*=b.a;float c=min(a.x,a.y);vec2 e=(d*2.-1.)/vec2(a.y/c,a.x/c);float g=clamp((length(e)-.7)/.6,0.,1.);b=mix(b,vec4(0.,0.,0.,1.),g*f),b.rgb/=b.a;return b;}void main(){gl_FragColor=texture2D(uPrevResult,vTexCoord);if(v!=0.)gl_FragColor=clamp(ca(gl_FragColor,vTexCoord,v),0.,1.);if(N!=0.)gl_FragColor=clamp(ba(gl_FragColor,N),0.,1.);if(L!=0.)gl_FragColor=clamp(da(gl_FragColor,L),0.,1.);if(M!=0.)gl_FragColor=clamp(ea(gl_FragColor,M),0.,1.);if(O!=0.)gl_FragColor=clamp(ga(gl_FragColor,vTexCoord,uResolution,O),0.,1.);if(K!=0.)gl_FragColor=fa(gl_FragColor,K);}",inputs:[W]}];class K{constructor(){this.initialized=!1,this.lastDimensions={width:0,height:0}}initialize(e){const t=new x({source:e.element}),r={a:t,A:ee(Q),z:ee(Z),B:ee({r:J,g:J,b:J})},a=new G({passes:q,textures:r,uniforms:te({filter:V,width:0,height:0,backgroundRemoved:!1})}),i=document.createElement("div"),n=new m((()=>new k(i,{env:{devicePixelRatio:1}})));n.onContextLost=()=>{n.restore()},n.load([t]),n.load(a),this.renderer=n,this.effect=a,this.sourceImageTexture=t,this.initialized=!0,this.timeoutId=window.setTimeout(this.dispose,16e3)}supportsImageBitmapRendering(){const e=navigator.userAgent.indexOf("Firefox")>-1;return!!window.createImageBitmap&&"undefined"!=typeof ImageBitmapRenderingContext&&!e}render({source:e,filter:t,backgroundRemoved:r,width:a,height:i}){if(this.initialized||this.initialize(e),!this.renderer||!this.effect||!this.sourceImageTexture)throw new Error("Renderer is not initialized");this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(this.dispose,16e3);return function(e,t){if(0===e.width&&0===e.height||0===t.width&&0===t.height)return!0;if(e.width===t.width&&e.height===t.height)return!1;return!0}(this.lastDimensions,{width:a,height:i})&&(this.renderer.resize(a,i),this.lastDimensions={width:a,height:i}),this.lastSource!==e&&(this.renderer.release([this.sourceImageTexture]),this.sourceImageTexture=new x({source:e.element}),this.renderer.load([this.sourceImageTexture]),this.lastSource=e),this.renderer.update([this.sourceImageTexture]),this.effect.update({textures:{a:this.sourceImageTexture},uniforms:te({filter:t?Y(t):V,width:a,height:i,backgroundRemoved:r})}),this.renderer.render(this.effect),this.renderer.canvas}dispose(){var e;this.timeoutId&&clearTimeout(this.timeoutId),null===(e=this.renderer)||void 0===e||e.dispose(),this.renderer=void 0,this.effect=void 0,this.timeoutId=void 0,this.initialized=!1}}const J=[{x:0,y:69},{x:79,y:96},{x:127,y:127},{x:255,y:225}],Q={r:[{x:0,y:0},{x:77,y:26},{x:179,y:204},{x:255,y:255}],g:[{x:0,y:0},{x:64,y:38},{x:191,y:217},{x:255,y:255}],b:[{x:0,y:0},{x:85,y:102},{x:170,y:153},{x:255,y:204}]},Z={r:[{x:0,y:0},{x:77,y:26},{x:179,y:51},{x:242,y:255}],g:[{x:0,y:0},{x:64,y:102},{x:153,y:153},{x:255,y:255}],b:[{x:0,y:0},{x:77,y:79},{x:153,y:153},{x:255,y:255}]};function ee(e){const t=H.fromPoints(e.r),r=H.fromPoints(e.g),a=H.fromPoints(e.b),i=new Uint8Array(768);for(let e=0;e<256;e++)i[3*e+0]=Math.max(0,Math.min(255,t.interpolate(e))),i[3*e+1]=Math.max(0,Math.min(255,r.interpolate(e))),i[3*e+2]=Math.max(0,Math.min(255,a.interpolate(e)));return new w({width:256,height:1,source:i})}function te({filter:e,width:t,height:r,backgroundRemoved:a}){const{r:i,g:n,b:o}=0!==e.tint?function({h:e,s:t,l:r}){if(0===t)return{r:e,g:e,b:e};{const a=r<.5?r*(1+t):r+t-r*t,i=2*r-a;return{r:re(i,a,e+1/3),g:re(i,a,e),b:re(i,a,e-1/3)}}}({h:ae(e.tint/200+.5-1/7,1),s:1,l:.5}):{r:0,g:0,b:0};return{D:e.brightness/200,E:e.contrast/100*.6,F:e.saturation/100+1,G:[i,n,o],s:(e.blur>=0?e.blur:3)*Math.max(t,r)/2e3,H:Math.min(Math.max(-e.blur,0),100),J:e.xpro/100,I:e.warmth/100*.1,N:e.vibrance/100,v:e.clarity/100,L:e.highlights/100,M:e.shadows/100,K:e.fade/100,O:e.vignette/100*.7,d:a?1:0}}function re(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function ae(e,t){return(e%t+t)%t}const ie="data-modifiers",ne="data-filter",{effectsRenderer:oe}={effectsRenderer:new K},se=e=>{const t=e.getAttribute(ie);return null!=t&&t.split(",").includes("STACKED_ALPHA_MASK")},ce=(e,t)=>{var r;const a=(e=>e.getAttribute(ne))(e),i=se(e);if(!i&&!a)return;const n=oe.supportsImageBitmapRendering()?t.getContext("bitmaprenderer"):t.getContext("2d");if(null==n)return;const o=()=>{e.style.opacity="0";const{transform:r,objectPosition:o}=getComputedStyle(e),s={type:"video",element:e},{videoWidth:c,videoHeight:u}=(e=>{const t=e.clientWidth,r=e.clientHeight,a=t/r,{videoWidth:i,videoHeight:n}=e,o=i/(n*(se(e)?.5:1)),s=o/a;return{videoWidth:s>1?r*o:t,videoHeight:s>1?r:t/o}})(e),l=oe.render({source:s,backgroundRemoved:i,filter:a,width:c,height:u}),{sx:h,sy:d,width:f,height:g}=((e,t,r)=>{const a=t.clientWidth,i=t.clientHeight,n=r.match(/\d+(?:\.\d+)?/g),o=n?{x:+n[0],y:+n[1]}:{x:50,y:50};return{sx:(e.width-a)*o.x/100,sy:(e.height-i)*o.y/100,width:a,height:i}})(l,e,o);oe.supportsImageBitmapRendering()&&n instanceof ImageBitmapRenderingContext?createImageBitmap(l,h,d,f,g).then((e=>{t.width=f,t.height=g,t.style.transform=r,n.transferFromImageBitmap(e)})):n instanceof CanvasRenderingContext2D&&(t.width=f,t.height=g,t.style.transform=r,n.clearRect(0,0,f,g),n.drawImage(l,h,d,f,g))};null===(r=e.parentNode)||void 0===r||r.prepend(t);let s=0;const c=()=>{e.readyState>=2&&(o(),s=requestAnimationFrame(c))};e.addEventListener("pause",(()=>{cancelAnimationFrame(s),s=0})),e.addEventListener("play",(()=>{s=requestAnimationFrame(c)})),e.addEventListener("loadeddata",(()=>{s=requestAnimationFrame(c)})),e.paused||(s=s||requestAnimationFrame(c))},ue=new Map;r((()=>{document.querySelectorAll(`video[${ie}], video[${ne}]`).forEach((e=>ue.set(e,(()=>{const e=document.createElement("canvas");return e.style.position="absolute",e.style.top="0",e.style.left="0",e})())));i((()=>{ue.forEach(((e,t)=>ce(t,e)))}),{runOnLoad:!0})}))}();